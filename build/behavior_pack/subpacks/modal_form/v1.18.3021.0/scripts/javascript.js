import{world as t,ItemStack as e,MinecraftItemTypes as n}from"mojang-minecraft";import{players as o,whitelist as i}from"scripts/credentials/access.js";import{client as a}from"scripts/gametests/commands/message.js";import*as r from"mojang-minecraft";import*as m from"mojang-gametest";import*as l from"mojang-minecraft-ui";import{viewObj as E}from"scripts/viewObj.js";import{md5 as p}from"scripts/blueimp-md5/md5.js";import{SHA256 as s}from"scripts/sha256.js";import*as y from"scripts/@types/mojang-minecraft/index.js";import*as c from"scripts/@types/mojang-gametest/index.js";import*as C from"scripts/@types/mojang-minecraft-ui/index.js";import{ModalFormData as v,MessageFormData as g}from"mojang-minecraft-ui";import{cloneJSON as d}from"scripts/clonejson.js";import{Base64 as f}from"scripts/base64.js";import u from"scripts/gametests/atrributions.js";export const prefix="$";export const formSettings={ModalForm:{dropdown:{defaultValueIndex:null},slider:{defaultValue:null},textField:{defaultValue:null},toggle:{defaultValue:null}}};function I(t){return"mojang-minecraft"==t?y:"mojang-gametest"==t?c:"mojang-minecraft-ui"==t?C:void 0}t.events.beforeChat.subscribe((t=>{const{message:r,sender:m}=t;let l=m.name??m.nameTag,E=!1;if(E=!(1!=i||!o.includes(l))||0==i,"$javascript"==r&&1==E){t.cancel=!0;let o=new e(n.enchantedBook,1);o.nameTag="§r§dJavaScript interpreter",o.setLore(["§r§5Use this item to open JavaScript interpreter"]),m.getComponent("minecraft:inventory").container.addItem(o),a(l,`You have been given a ${o.nameTag}`)}else"$attributions"==r&&1==E&&(t.cancel=!0,a(l,u()))}));export function codeExecute(t,e,n){let o=n,i=new v;i.title("JavaScript Interpreter"),i.textField("Text Field","Type here",o.ModalForm.textField.defaultValue),i.toggle("Use Mojang Namespace",o.ModalForm.toggle.defaultValue),i.show(t).then((n=>{const{formValues:i}=n;let[y,c]=i;if(/[a-z]/i.test(y)&&a(e,`${y}`),1==c){(new Date).getTime();0;try{new Function("Direction","GameMode","BeforeChatEvent","BeforeChatEventSignal","BeforeDataDrivenEntityTriggerEvent","BeforeDataDrivenEntityTriggerEventSignal","BeforeExplosionEvent","BeforeExplosionEventSignal","BeforeItemDefinitionEventSignal","BeforeItemDefinitionTriggeredEvent","BeforeItemUseEvent","BeforeItemUseEventSignal","BeforeItemUseOnEvent","BeforeItemUseOnEventSignal","BlockEvent","BeforePistonActivateEvent","BeforePistonActivateEventSignal","Block","BlockAreaSize","BlockBreakEvent","BlockBreakEventSignal","BlockComponent","BlockExplodeEvent","BlockExplodeEventSignal","BlockInventoryComponent","Container","BlockInventoryComponentContainer","BlockLavaContainerComponent","BlockLocation","BlockPermutation","BlockPistonComponent","BlockPlaceEvent","BlockPlaceEventSignal","BlockPotionContainerComponent","BlockProperties","BlockRaycastOptions","BlockRecordPlayerComponent","BlockSnowContainerComponent","BlockType","BlockWaterContainerComponent","IBlockProperty","BoolBlockProperty","ChatEvent","ChatEventSignal","Color","DataDrivenEntityTriggerEvent","DataDrivenEntityTriggerEventSignal","DefinitionModifier","Dimension","Effect","EffectAddEvent","EffectAddEventSignal","EffectType","Enchantment","EnchantmentList","EnchantmentSlot","EnchantmentType","EntityType","EntityTypes","MinecraftEntityTypes","Entity","IEntityComponent","EntityAddRiderComponent","EntityAgeableComponent","EntityBreathableComponent","EntityCanClimbComponent","EntityCanFlyComponent","EntityCanPowerJumpComponent","EntityColorComponent","EntityCreateEvent","EntityCreateEventSignal","EntityDataDrivenTriggerEventOptions","EntityDefinitionFeedItem","EntityEventOptions","EntityFireImmuneComponent","EntityFloatsInLiquidComponent","EntityFlyingSpeedComponent","EntityFrictionModifierComponent","EntityGroundOffsetComponent","EntityHealableComponent","EntityHealthComponent","EntityHitEvent","EntityHitEventSignal","EntityInventoryComponent","EntityIsBabyComponent","EntityIsChargedComponent","EntityIsChestedComponent","EntityIsDyableComponent","EntityIsHiddenWhenInvisibleComponent","EntityIsIgnitedComponent","EntityIsIllagerCaptainComponent","EntityIsSaddledComponent","EntityIsShakingComponent","EntityIsShearedComponent","EntityIsStackableComponent","EntityIsStunnedComponent","EntityIsTamedComponent","EntityItemComponent","EntityIterator","EntityLavaMovementComponent","EntityLeashableComponent","EntityMarkVariantComponent","EntityMountTamingComponent","EntityMovementAmphibiousComponent","EntityMovementBasicComponent","EntityMovementComponent","EntityMovementFlyComponent","EntityMovementGenericComponent","EntityMovementGlideComponent","EntityMovementHoverComponent","EntityMovementJumpComponent","EntityMovementSkipComponent","EntityMovementSwayComponent","EntityNavigationClimbComponent","EntityNavigationFloatComponent","EntityNavigationFlyComponent","EntityNavigationGenericComponent","EntityNavigationHoverComponent","EntityNavigationWalkComponent","EntityPushThroughComponent","EntityQueryOptions","EntityQueryScoreOptions","EntityRaycastOptions","EntityRideableComponent","EntityScaleComponent","EntitySkinIdComponent","EntityStrengthComponent","EntityTameableComponent","EntityUnderwaterMovementComponent","EntityVariantComponent","EntityWantsJockeyComponent","Events","ExplosionEvent","ExplosionEventSignal","ExplosionOptions","FeedItem","FeedItemEffect","FilterGroup","FluidContainer","IntBlockProperty","InventoryComponentContainer","ItemCooldownComponent","ItemDefinitionEventSignal","ItemDefinitionTriggeredEvent","ItemDurabilityComponent","ItemEnchantsComponent","ItemFoodComponent","Items","ItemStack","ItemType","ItemUseEvent","ItemUseEventSignal","ItemUseOnEvent","ItemUseOnEventSignal","Location","MinecraftBlockTypes","MinecraftDimensionTypes","MinecraftEffectTypes","MinecraftEnchantmentTypes","MinecraftItemTypes","MolangVariableMap","MusicOptions","NavigationResult","NumberRange","PistonActivateEvent","PistonActivateEventSignal","PitchYawRotation","Player","PlayerInventoryComponentContainer","PlayerIterator","PlayerJoinEvent","PlayerJoinEventSignal","PlayerLeaveEvent","PlayerLeaveEventSignal","Seat","SoundOptions","StringBlockProperty","TickEvent","TickEventSignal","Trigger","Vector","WeatherChangeEvent","WeatherChangeEventSignal","World","TicksPerSecond","world","FluidType","FenceConnectivity","GameTestSequence","RegistrationBuilder","SimulatedPlayer","Tags","Test","register","ActionFormData","ActionFormResponse","FormResponse","MessageFormData","MessageFormResponse","ModalFormData","ModalFormResponse","viewObj","md5","sha256","getIndex","cloneJSON","Base64",`return (function () { ${y} });`)(r.Direction,r.GameMode,r.BeforeChatEvent,r.BeforeChatEventSignal,r.BeforeDataDrivenEntityTriggerEvent,r.BeforeDataDrivenEntityTriggerEventSignal,r.BeforeExplosionEvent,r.BeforeExplosionEventSignal,r.BeforeItemDefinitionEventSignal,r.BeforeItemDefinitionTriggeredEvent,r.BeforeItemUseEvent,r.BeforeItemUseEventSignal,r.BeforeItemUseOnEvent,r.BeforeItemUseOnEventSignal,r.BlockEvent,r.BeforePistonActivateEvent,r.BeforePistonActivateEventSignal,r.Block,r.BlockAreaSize,r.BlockBreakEvent,r.BlockBreakEventSignal,r.BlockComponent,r.BlockExplodeEvent,r.BlockExplodeEventSignal,r.BlockInventoryComponent,r.Container,r.BlockInventoryComponentContainer,r.BlockLavaContainerComponent,r.BlockLocation,r.BlockPermutation,r.BlockPistonComponent,r.BlockPlaceEvent,r.BlockPlaceEventSignal,r.BlockPotionContainerComponent,r.BlockProperties,r.BlockRaycastOptions,r.BlockRecordPlayerComponent,r.BlockSnowContainerComponent,r.BlockType,r.BlockWaterContainerComponent,r.IBlockProperty,r.BoolBlockProperty,r.ChatEvent,r.ChatEventSignal,r.Color,r.DataDrivenEntityTriggerEvent,r.DataDrivenEntityTriggerEventSignal,r.DefinitionModifier,r.Dimension,r.Effect,r.EffectAddEvent,r.EffectAddEventSignal,r.EffectType,r.Enchantment,r.EnchantmentList,r.EnchantmentSlot,r.EnchantmentType,r.EntityType,r.EntityTypes,r.MinecraftEntityTypes,r.Entity,r.IEntityComponent,r.EntityAddRiderComponent,r.EntityAgeableComponent,r.EntityBreathableComponent,r.EntityCanClimbComponent,r.EntityCanFlyComponent,r.EntityCanPowerJumpComponent,r.EntityColorComponent,r.EntityCreateEvent,r.EntityCreateEventSignal,r.EntityDataDrivenTriggerEventOptions,r.EntityDefinitionFeedItem,r.EntityEventOptions,r.EntityFireImmuneComponent,r.EntityFloatsInLiquidComponent,r.EntityFlyingSpeedComponent,r.EntityFrictionModifierComponent,r.EntityGroundOffsetComponent,r.EntityHealableComponent,r.EntityHealthComponent,r.EntityHitEvent,r.EntityHitEventSignal,r.EntityInventoryComponent,r.EntityIsBabyComponent,r.EntityIsChargedComponent,r.EntityIsChestedComponent,r.EntityIsDyableComponent,r.EntityIsHiddenWhenInvisibleComponent,r.EntityIsIgnitedComponent,r.EntityIsIllagerCaptainComponent,r.EntityIsSaddledComponent,r.EntityIsShakingComponent,r.EntityIsShearedComponent,r.EntityIsStackableComponent,r.EntityIsStunnedComponent,r.EntityIsTamedComponent,r.EntityItemComponent,r.EntityIterator,r.EntityLavaMovementComponent,r.EntityLeashableComponent,r.EntityMarkVariantComponent,r.EntityMountTamingComponent,r.EntityMovementAmphibiousComponent,r.EntityMovementBasicComponent,r.EntityMovementComponent,r.EntityMovementFlyComponent,r.EntityMovementGenericComponent,r.EntityMovementGlideComponent,r.EntityMovementHoverComponent,r.EntityMovementJumpComponent,r.EntityMovementSkipComponent,r.EntityMovementSwayComponent,r.EntityNavigationClimbComponent,r.EntityNavigationFloatComponent,r.EntityNavigationFlyComponent,r.EntityNavigationGenericComponent,r.EntityNavigationHoverComponent,r.EntityNavigationWalkComponent,r.EntityPushThroughComponent,r.EntityQueryOptions,r.EntityQueryScoreOptions,r.EntityRaycastOptions,r.EntityRideableComponent,r.EntityScaleComponent,r.EntitySkinIdComponent,r.EntityStrengthComponent,r.EntityTameableComponent,r.EntityUnderwaterMovementComponent,r.EntityVariantComponent,r.EntityWantsJockeyComponent,r.Events,r.ExplosionEvent,r.ExplosionEventSignal,r.ExplosionOptions,r.FeedItem,r.FeedItemEffect,r.FilterGroup,r.FluidContainer,r.IntBlockProperty,r.InventoryComponentContainer,r.ItemCooldownComponent,r.ItemDefinitionEventSignal,r.ItemDefinitionTriggeredEvent,r.ItemDurabilityComponent,r.ItemEnchantsComponent,r.ItemFoodComponent,r.Items,r.ItemStack,r.ItemType,r.ItemUseEvent,r.ItemUseEventSignal,r.ItemUseOnEvent,r.ItemUseOnEventSignal,r.Location,r.MinecraftBlockTypes,r.MinecraftDimensionTypes,r.MinecraftEffectTypes,r.MinecraftEnchantmentTypes,r.MinecraftItemTypes,r.MolangVariableMap,r.MusicOptions,r.NavigationResult,r.NumberRange,r.PistonActivateEvent,r.PistonActivateEventSignal,r.PitchYawRotation,r.Player,r.PlayerInventoryComponentContainer,r.PlayerIterator,r.PlayerJoinEvent,r.PlayerJoinEventSignal,r.PlayerLeaveEvent,r.PlayerLeaveEventSignal,r.Seat,r.SoundOptions,r.StringBlockProperty,r.TickEvent,r.TickEventSignal,r.Trigger,r.Vector,r.WeatherChangeEvent,r.WeatherChangeEventSignal,r.World,r.TicksPerSecond,r.world,m.FluidType,m.FenceConnectivity,m.GameTestSequence,m.RegistrationBuilder,m.SimulatedPlayer,m.Tags,m.Test,m.register,l.ActionFormData,l.ActionFormResponse,l.FormResponse,l.MessageFormData,l.MessageFormResponse,l.ModalFormData,l.ModalFormResponse,E,p,s,I,d,f)(),o.ModalForm.toggle.defaultValue=c,o.ModalForm.textField.defaultValue=y}catch(n){n.stack;{a(e,`§c${n}\n${n.stack.split("\n").slice(0,-2)}`);let i=new g;i.title("Scripting Error"),i.body(`${n}\n${n.stack.split("\n").slice(0,-2)}`),i.button1("Exit"),i.button2("Fix Your Code"),i.show(t).then((n=>{const{selection:i}=n;0==i&&(o.ModalForm.toggle.defaultValue=c,o.ModalForm.textField.defaultValue=y,codeExecute(t,e,o))}))}}}else try{const t=new Function("mojangminecraft","mojanggametest","mojangminecraftui","viewObj","md5","sha256","getIndex","cloneJSON","Base64",`return (function () { ${y} });`)(r,m,l,E,p,s,I,d,f);o.ModalForm.toggle.defaultValue=c,o.ModalForm.textField.defaultValue=y,t()}catch(n){n.stack;{a(e,`§c${n}\n${n.stack.split("\n").slice(0,-2)}`);let i=new g;i.title("Scripting Error"),i.body(`${n}\n${n.stack.split("\n").slice(0,-2)}`),i.button1("Exit"),i.button2("Fix Your Code"),i.show(t).then((n=>{const{selection:i}=n;0==i&&(o.ModalForm.toggle.defaultValue=c,o.ModalForm.textField.defaultValue=y,codeExecute(t,e,o))}))}}}))}t.events.beforeItemUse.subscribe((t=>{let{source:e,item:n}=t,o=e.name??e.nameTag;if("minecraft:enchanted_book"==n.id&&"§r§5Use this item to open JavaScript interpreter"==n.getLore()[0]){let t=formSettings;null==t.ModalForm.toggle.defaultValue&&(t.ModalForm.toggle.defaultValue=!0),codeExecute(e,o,t)}}));