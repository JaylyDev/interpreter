import{world as e,ItemStack as t,MinecraftItemTypes as a}from"mojang-minecraft";import{players as n,whitelist as r}from"scripts/credentials/access.js";import{client as o}from"scripts/gametests/commands/message.js";import{ModalFormData as l,MessageFormData as i}from"mojang-minecraft-ui";function s(e){let t=new Uint8Array(500),a=0,n=0,r=0,o=[],l="";for(;a<e.length;a++)if("["===e[a])o.push({start:a});else if("]"===e[a]){for(let e=o.length-1;e>=0;e--)if(!o[e].end){o[e].end=a;break}}else"!"===e[a]&&(n=a+1);for(a=0;a<e.length&&"!"!==e[a];){switch(e[a]){case"+":t[r]++;break;case"-":t[r]--;break;case">":r++;break;case"<":r--;break;case"[":0===t[r]&&(a=o.find((e=>a===e.start)).end);break;case"]":0!==t[r]&&(a=o.find((e=>a===e.end)).start);break;case".":l+=String.fromCharCode(t[r]);break;case",":t[r]=e[n++].charCodeAt(0)}a++}return l}const c={ModalForm:{dropdown:{defaultValueIndex:null},slider:{defaultValue:null},textField:{defaultValue:null},toggle:{defaultValue:null}}};function d(e,t,a){let n=a,r=new l;r.title("BrainFuck Interpreter"),r.textField("Text Field","Type here",n.ModalForm.textField.defaultValue),r.show(e).then((a=>{const{formValues:r}=a;let[l,c]=r;l&&o(t,`${l}\n${s(l)}`);try{let a=new i;a.title("Scripting Output"),a.body(s(l)),a.button1("Exit"),a.button2("Go Back"),a.show(e).then((a=>{const{selection:r}=a;0==r&&(n.ModalForm.toggle.defaultValue=c,n.ModalForm.textField.defaultValue=l,d(e,t,n))}))}catch(a){a.stack;{o(t,`${a}\n${a.stack.split("\n").slice(0,-2)}`);let r=new i;r.title("Scripting Error"),r.body(`${a}\n${a.stack.split("\n").slice(0,-2)}`),r.button1("Exit"),r.button2("Fix Your Code"),r.show(e).then((a=>{const{selection:r}=a;0==r&&(n.ModalForm.toggle.defaultValue=c,n.ModalForm.textField.defaultValue=l,d(e,t,n))}))}}}))}e.events.beforeChat.subscribe((e=>{const{message:l,sender:i}=e;let s=i.name??i.nameTag,c=!1;if(c=!(1!=r||!n.includes(s))||0==r,"$brainfuck"==l&&1==c){e.cancel=!0;let n=new t(a.enchantedBook,1);n.nameTag="§r§dBrainFuck interpreter",n.setLore(["§r§5Use this item to open BrainFuck interpreter"]),i.getComponent("minecraft:inventory").container.addItem(n),o(s,`You have been given a ${n.nameTag}`)}})),e.events.beforeItemUse.subscribe((e=>{let{source:t,item:a}=e,n=t.name??t.nameTag;if("minecraft:enchanted_book"==a.id&&"§r§5Use this item to open BrainFuck interpreter"==a.getLore()[0]){let e=c;e.ModalForm.toggle.defaultValue=!0,d(t,n,e)}}));