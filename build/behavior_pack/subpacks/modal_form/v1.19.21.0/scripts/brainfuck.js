import{world as e,ItemStack as t,MinecraftItemTypes as n}from"mojang-minecraft";import{players as a,whitelist as r,devBuild as o,addon_prefix as l}from"scripts/credentials/access.js";import{client as i}from"scripts/gametests/commands/message.js";import{ModalFormData as s,MessageFormData as c}from"mojang-minecraft-ui";function d(e){let t=new Uint8Array(500),n=0,a=0,r=0,o=[],l="";for(;n<e.length;n++)if("["===e[n])o.push({start:n});else if("]"===e[n]){for(let e=o.length-1;e>=0;e--)if(!o[e].end){o[e].end=n;break}}else"!"===e[n]&&(a=n+1);for(n=0;n<e.length&&"!"!==e[n];){switch(e[n]){case"+":t[r]++;break;case"-":t[r]--;break;case">":r++;break;case"<":r--;break;case"[":0===t[r]&&(n=o.find((e=>n===e.start)).end);break;case"]":0!==t[r]&&(n=o.find((e=>n===e.end)).start);break;case".":l+=String.fromCharCode(t[r]);break;case",":t[r]=e[a++].charCodeAt(0)}n++}return l}const u={ModalForm:{dropdown:{defaultValueIndex:null},slider:{defaultValue:null},textField:{defaultValue:null},toggle:{defaultValue:null}}};function m(e,t,n){let a=n,r=new s;r.title("BrainFuck Interpreter"),r.textField("Text Field","Type here",a.ModalForm.textField.defaultValue),r.show(e).then((n=>{const{formValues:r}=n;let[l,s]=r;l&&i(t,`${l}\n${d(l)}`);try{let n=new c;n.title("Scripting Output"),n.body(d(l)),n.button1("Exit"),n.button2("Go Back"),n.show(e).then((n=>{const{selection:r}=n;0==r&&(a.ModalForm.toggle.defaultValue=s,a.ModalForm.textField.defaultValue=l,m(e,t,a))}))}catch(n){if(n.stack&&1==o){i(t,"§c"+(String(n)+"\n"+String(n.stack)));let r=new c;r.title("Scripting Error"),r.body(String(n)+"\n"+String(n.stack)),r.button1("Exit"),r.button2("Fix Your Code"),r.show(e).then((n=>{const{selection:r}=n;0==r&&(a.ModalForm.toggle.defaultValue=s,a.ModalForm.textField.defaultValue=l,m(e,t,a))}))}else{i(t,`${n}\n${n.stack.split("\n").slice(0,-2)}`);let r=new c;r.title("Scripting Error"),r.body(`${n}\n${n.stack.split("\n").slice(0,-2)}`),r.button1("Exit"),r.button2("Fix Your Code"),r.show(e).then((n=>{const{selection:r}=n;0==r&&(a.ModalForm.toggle.defaultValue=s,a.ModalForm.textField.defaultValue=l,m(e,t,a))}))}}}))}e.events.beforeChat.subscribe((e=>{const{message:o,sender:s}=e;let c=s.name??s.nameTag,d=!1;if(d=!(1!=r||!a.includes(c))||0==r,o==`${l}brainfuck`&&1==d){e.cancel=!0;let a=new t(n.enchantedBook,1);a.nameTag="§r§dBrainFuck interpreter",a.setLore(["§r§5Use this item to open BrainFuck interpreter"]),s.getComponent("minecraft:inventory").container.addItem(a),i(c,`You have been given a ${a.nameTag}`)}})),e.events.beforeItemUse.subscribe((e=>{let{source:t,item:n}=e,a=t.name??t.nameTag;if("minecraft:enchanted_book"==n.id&&"§r§5Use this item to open BrainFuck interpreter"==n.getLore()[0]){let e=u;e.ModalForm.toggle.defaultValue=!0,m(t,a,e)}}));