import{world as e,ItemStack as t,MinecraftItemTypes as a}from"mojang-minecraft";import{players as o,whitelist as n,devBuild as r,addon_prefix as i}from"scripts/credentials/access.js";import{client as s}from"scripts/gametests/commands/message.js";import*as l from"mojang-minecraft";import*as c from"mojang-gametest";import*as m from"mojang-minecraft-server-admin";import*as u from"mojang-minecraft-ui";import{viewObj as d}from"scripts/viewObj.js";import{md5 as g}from"scripts/blueimp-md5/md5.js";import{SHA256 as f}from"scripts/sha256.js";import{ModalFormData as p,MessageFormData as j}from"mojang-minecraft-ui";import{Base64 as b}from"scripts/base64.js";import F from"scripts/gametests/atrributions.js";let h={};export const formSettings={ModalForm:{dropdown:{defaultValueIndex:null},slider:{defaultValue:null},textField:{defaultValue:null},toggle:{defaultValue:null}}};e.events.beforeChat.subscribe((e=>{const{message:r,sender:l}=e;let c=l.name??l.nameTag,m=!1;if(m=!(1!=n||!o.includes(c))||0==n,r==`${i}javascript`&&1==m){e.cancel=!0;let o=new t(a.enchantedBook,1);o.nameTag="§r§dJavaScript interpreter",o.setLore(["§r§5Use this item to open JavaScript interpreter"]),l.getComponent("minecraft:inventory").container.addItem(o),s(c,`You have been given a ${o.nameTag}`)}else r==`${i}attributions`&&1==m&&(e.cancel=!0,s(c,F()))}));export async function codeExecute(e,t,a){let o=a,n=new p;await import("mojang-net").then((function(e){h=e})).catch((e=>{console.log(e)})),n.title("JavaScript Interpreter"),n.textField("Text Field","Type here",o.ModalForm.textField.defaultValue),n.toggle("Use Mojang Namespace",o.ModalForm.toggle.defaultValue),n.show(e).then((a=>{const{formValues:n}=a;let[i,p]=n;/[a-z]/i.test(i)&&s(t,`${i}`);const j=(new Date).getTime();if(1==p){!0===r&&console.warn(`JavaScript: §6Program starts at: ${new Date}`);try{const e={...l,...c,...u,...m,...h,viewObj:d,md5:g,sha256:f,Base64:b};new Function(`{${Object.keys(e).join(",")}}`,`return (function () { ${i} });`)(e)(),!0===r&&console.warn(`JavaScript: §aAll checks have passed. Time Duration: ${((new Date).getTime()-j)/1e3} seconds`),o.ModalForm.toggle.defaultValue=p,o.ModalForm.textField.defaultValue=i}catch(a){v(a,j,e,t,o,p,i)}}else try{const e={mojangminecraft:l,mojanggametest:c,mojangminecraftui:u,mojangminecraftserveradmin:m,mojangnet:h,viewObj:d,md5:g,sha256:f,Base64:b};new Function(`{${Object.keys(e).join(",")}}`,`return (function () { ${i} });`)(e)(),o.ModalForm.toggle.defaultValue=p,o.ModalForm.textField.defaultValue=i}catch(a){v(a,j,e,t,o,p,i)}}))}function v(e,t,a,o,n,i,l){let c=new j;if(!0===r){console.warn(`JavaScript: §cSome checks were not successful. Time Duration: ${((new Date).getTime()-t)/1e3} seconds`);var m=e.stack?`\n${e.stack}`:"";s(o,`Dev build POV:\n§c${String(e+m)}`),m=e.stack?`\n${e.stack.split("\n").slice(0,-2).join("\n")}`:"",s(o,`Non-dev build POV:\n§c${String(e+m)}`),c.title("Scripting Error").body(String(e+m)).button1("Exit").button2("Fix Your Code"),c.show(a).then((e=>{const{selection:t}=e;0===t&&(n.ModalForm.toggle.defaultValue=i,n.ModalForm.textField.defaultValue=l,codeExecute(a,o,n))}))}else{m=e.stack?`\n${e.stack.split("\n").slice(0,-2).join("\n")}`:"";s(o,`§c${String(e+m)}`),c.title("Scripting Error").body(String(e+m)).button1("Exit").button2("Fix Your Code"),c.show(a).then((e=>{const{selection:t}=e;0===t&&(n.ModalForm.toggle.defaultValue=i,n.ModalForm.textField.defaultValue=l,codeExecute(a,o,n))}))}}e.events.beforeItemUse.subscribe((e=>{let{source:t,item:a}=e,o=t.name??t.nameTag;if("minecraft:enchanted_book"==a.id&&"§r§5Use this item to open JavaScript interpreter"==a.getLore()[0]){let e=formSettings;null==e.ModalForm.toggle.defaultValue&&(e.ModalForm.toggle.defaultValue=!0),codeExecute(t,o,e)}}));